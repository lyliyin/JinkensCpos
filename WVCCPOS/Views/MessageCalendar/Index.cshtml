
@section styles{
    <link href="~/Content/fullcalendar/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/fullcalendar/fullcalendar.css" rel="stylesheet" />
    <style type="text/css">
        .bootbox {
            margin: 0 auto;
        }

        .modal {
            position: fixed;
            top: 10%;
            left: 35%;
            z-index: 1050;
            margin-left: -280px;
            background-color: #fff;
            border: 1px solid #999;
            border: 1px solid rgba(0,0,0,0.3);
            *border: 1px solid #999;
            -webkit-border-radius: 6px;
            -moz-border-radius: 6px;
            border-radius: 6px;
            outline: 0;
            -webkit-box-shadow: 0 3px 7px rgba(0,0,0,0.3);
            -moz-box-shadow: 0 3px 7px rgba(0,0,0,0.3);
            box-shadow: 0 3px 7px rgba(0,0,0,0.3);
            -webkit-background-clip: padding-box;
            -moz-background-clip: padding-box;
            background-clip: padding-box;
        }

        .fc-header {
            margin-top: 15px;
        }
    </style>
}

<div class="container-fluid">
    <!-- BEGIN PAGE HEADER-->
    <div class="row-fluid">
        <div class="span12">
            <!-- BEGIN THEME CUSTOMIZER-->
            <!-- END THEME CUSTOMIZER-->
            <h3 class="page-title">
                备忘录管理
            </h3>
            <ul class="breadcrumb">
                <li>
                    <a href="#"><i class="icon-home"></i></a><span class="divider">&nbsp;</span>
                </li>
                <li><a href="#">消息中心</a><span class="divider-last">&nbsp;</span></li>
            </ul>
        </div>
    </div>
    <div class="row-fluid widget">
        <div class="row">
            <div class="col-xs-12">
                <!-- PAGE CONTENT BEGINS -->
                <div class="row">
                    <div class="col-sm-11">
                        <div class="space"></div>

                        <div id="calendar" class="fc fc-ltr">
                            <div class="fc-content" style="position: relative;">
                                <div class="fc-view fc-view-agendaWeek fc-agenda" style="position:relative" unselectable="on">
                                    <div style="position: absolute; z-index: 2; left: 0px; width: 100%; top: 21.6px;">
                                        <div class="fc-event-container" style="position:absolute;z-index:8;top:0;left:0">
                                            <div class="fc-event fc-event-hori fc-event-draggable fc-event-start fc-event-end label-important ui-draggable" style="position: absolute; left: 558.2px; width: 121px; top: 21px;" unselectable="on">
                                                <div class="fc-event-inner">
                                                    <span class="fc-event-title">所有事件title</span>
                                                </div>
                                                <div class="ui-resizable-handle ui-resizable-e">&nbsp;&nbsp;&nbsp;</div>
                                            </div><div class="fc-event fc-event-hori fc-event-draggable fc-event-start fc-event-end label-success ui-draggable" style="position: absolute; left: 305.4px; width: 500.2px; top: 2px;" unselectable="on">
                                                <div class="fc-event-inner">
                                                    <span class="fc-event-title">Long Event</span>
                                                </div><div class="ui-resizable-handle ui-resizable-e">&nbsp;&nbsp;&nbsp;</div>
                                            </div>
                                        </div>
                                        <table style="width:100%" class="fc-agenda-allday" cellspacing="0">
                                            <tbody>
                                                <tr>
                                                    <th class="fc-widget-header fc-agenda-axis" style="width: 50px;">全天</th>
                                                    <td>
                                                        <div class="fc-day-content"><div style="position: relative; height: 38px;"></div></div>
                                                    </td>
                                                    <th class="fc-widget-header fc-agenda-gutter" style="width: 17px;">&nbsp;</th>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <div class="fc-agenda-divider fc-widget-header"><div class="fc-agenda-divider-inner"></div></div><div style="position: absolute; width: 100%; overflow-x: hidden; overflow-y: auto; height: 653.6px;">
                                            <div style="position:relative;width:100%;overflow:hidden">
                                                <div class="fc-event-container" style="position:absolute;z-index:8;top:0;left:0">

                                                    <div class="fc-event fc-event-vert fc-event-draggable fc-event-start fc-event-end ui-draggable ui-resizable" style="position: absolute; top: 665px; left: 558.2px; width: 115.975px; height: 81px;">
                                                        <div class="fc-event-inner">
                                                            <div class="fc-event-time">4:00</div><div class="fc-event-title">Some Event</div>
                                                        </div>
                                                        <div class="fc-event-bg"></div><div class="ui-resizable-handle ui-resizable-s">=</div>
                                                    </div>

                                                </div>
                                                <table class="fc-agenda-slots" style="width:100%" cellspacing="0">
                                                    <tbody>
                                                        <tr class="fc-slot0 ">
                                                            <th class="fc-agenda-axis fc-widget-header" style="width: 50px;">24点</th>
                                                            <td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td>
                                                        </tr>
                                                        <tr class="fc-slot1 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot2 "><th class="fc-agenda-axis fc-widget-header">1点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot3 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot4 "><th class="fc-agenda-axis fc-widget-header">2点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot5 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot6 "><th class="fc-agenda-axis fc-widget-header">3点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot7 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot8 "><th class="fc-agenda-axis fc-widget-header">4点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot9 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot10 "><th class="fc-agenda-axis fc-widget-header">5点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot11 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot12 "><th class="fc-agenda-axis fc-widget-header">6点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot13 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot14 "><th class="fc-agenda-axis fc-widget-header">7点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot15 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot16 "><th class="fc-agenda-axis fc-widget-header">8点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot17 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot18 "><th class="fc-agenda-axis fc-widget-header">9点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot19 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot20 "><th class="fc-agenda-axis fc-widget-header">10点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot21 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot22 "><th class="fc-agenda-axis fc-widget-header">11点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot23 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot24 "><th class="fc-agenda-axis fc-widget-header">12点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot25 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot26 "><th class="fc-agenda-axis fc-widget-header">13点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot27 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot28 "><th class="fc-agenda-axis fc-widget-header">14点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot29 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot30 "><th class="fc-agenda-axis fc-widget-header">15点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot31 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot32 "><th class="fc-agenda-axis fc-widget-header">16点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot33 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot34 "><th class="fc-agenda-axis fc-widget-header">17点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot35 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot36 "><th class="fc-agenda-axis fc-widget-header">18点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot37 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot38 "><th class="fc-agenda-axis fc-widget-header">19点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot39 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot40 "><th class="fc-agenda-axis fc-widget-header">20点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot41 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot42 "><th class="fc-agenda-axis fc-widget-header">21点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot43 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot44 "><th class="fc-agenda-axis fc-widget-header">22点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot45 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot46 "><th class="fc-agenda-axis fc-widget-header">23点</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                        <tr class="fc-slot47 fc-minor"><th class="fc-agenda-axis fc-widget-header">&nbsp;</th><td class="fc-widget-content"><div style="position:relative">&nbsp;</div></td></tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PAGE CONTENT ENDS -->
            </div><!-- /.col -->
        </div>
    </div>
</div>


<script src="~/Scripts/fullcalendar/jquery-1.10.2.min.js"></script>

<script type="text/javascript">
    if ("ontouchend" in document) document.write("<script src=~/Scripts/fullcalendar/jquery.mobile.custom.min.js'>" + "<" + "/script>");
</script>
<script src="~/Scripts/fullcalendar/bootstrap.min.js"></script>

<script src="~/Scripts/fullcalendar/typeahead-bs2.min.js"></script>

<!-- page specific plugin scripts -->

<script src="~/Scripts/fullcalendar/jquery-ui-1.10.3.custom.min.js"></script>
<script src="~/Scripts/fullcalendar/jquery.ui.touch-punch.min.js"></script>
<script src="~/Scripts/fullcalendar/fullcalendar.min.js"></script>
<script src="~/Scripts/fullcalendar/bootbox.min.js"></script>

<!-- ace scripts -->

<script src="~/Scripts/fullcalendar/ace-elements.min.js"></script>
<script src="~/Scripts/fullcalendar/ace.min.js"></script>


<script src="~/Scripts/fullcalendar/fullcalendar.min.js"></script>
<script type="text/javascript">
    $(function ($) {
        /* initialize the external events
            -----------------------------------------------------------------*/
        $('#external-events div.external-event').each(function () {

            // create an Event Object (http://arshaw.com/fullcalendar/docs/event_data/Event_Object/)
            // it doesn't need to have a start or end
            var eventObject = {
                title: $.trim($(this).text())// use the element's text as the event title
            };

            // store the Event Object in the DOM element so we can get to it later
            $(this).data('eventObject', eventObject);

            // make the event draggable using jQuery UI
            $(this).draggable({
                zIndex: 999,
                revert: true,      // will cause the event to go back to its
                revertDuration: 0  //  original position after the drag
            });

        });




        /* initialize the calendar
        -----------------------------------------------------------------*/

        var date = new Date();
        var d = date.getDate();
        var m = date.getMonth();
        var y = date.getFullYear();

        var calendar = $('#calendar').fullCalendar({
            buttonText: {
                prev: '<i class="icon-chevron-left"></i>',
                next: '<i class="icon-chevron-right"></i>'
            },

            header: {
                left: 'prev,next 今天',
                center: 'title',
                right: 'month,agendaWeek,agendaDay'
            },
            events: [
            {
                title: 'All Day Event',
                start: new Date(y, m, 1),
                className: 'label-important'
            },
            {
                title: 'Long Event',
                start: new Date(y, m, d - 5),
                end: new Date(y, m, d - 2),
                className: 'label-success'
            },
            {
                title: 'Some Event',
                start: new Date(y, m, d - 3, 16, 0),
                allDay: false
            }]
            ,
            editable: true,
            droppable: true, // this allows things to be dropped onto the calendar !!!
            drop: function (date, allDay) { // this function is called when something is dropped

                // retrieve the dropped element's stored Event Object
                var originalEventObject = $(this).data('eventObject');
                var $extraEventClass = $(this).attr('data-class');


                // we need to copy it, so that multiple events don't have a reference to the same object
                var copiedEventObject = $.extend({}, originalEventObject);

                // assign it the date that was reported
                copiedEventObject.start = date;
                copiedEventObject.allDay = allDay;
                if ($extraEventClass) copiedEventObject['className'] = [$extraEventClass];

                // render the event on the calendar
                // the last `true` argument determines if the event "sticks" (http://arshaw.com/fullcalendar/docs/event_rendering/renderEvent/)
                $('#calendar').fullCalendar('renderEvent', copiedEventObject, true);

                // is the "remove after drop" checkbox checked?
                if ($('#drop-remove').is(':checked')) {
                    // if so, remove the element from the "Draggable Events" list
                    $(this).remove();
                }

            }
            ,
            selectable: true,
            selectHelper: true,
            select: function (start, end, allDay) {
                var form = $("<form class='form-inline'><label>添加新事件信息</label></form>");
                form.append("<div class='control-group'> <label class='control-label col-md-2'>BrandName</label>");
                form.append("<div class='controls'>");
                form.append("<input class='text-box single-line' data-val='true' data-val-length='字段 BrandName 必须是最大长度为 50 的字符串。' data-val-length-max='50' id='title' name='title' type='text' value=''>");
                form.append("</div></div>");
                form.append("<br/>");
                form.append("<button type='submit' class='btn btn-sm btn-success'><i class='icon-ok'></i> Save</button>");

                var div = bootbox.dialog({
                    buttons: {
                        "close": {
                            "label": "<i class='icon-remove'></i> Close",
                            "className": "btn-sm"
                        }
                    },
                    message: form
                });


                form.on('submit', function () {
                    div.modal("hide");
                    var title = form.find("input[name='title']").val();
                    alert(title);

                    calendar.fullCalendar('renderEvent',
                            {
                                title: "小银子",
                                start: start,
                                Remark: "Remark",
                                UserNames: "李银、小俊子",
                                end: end,
                                allDay: allDay
                            },
                            true // make the event "stick"
                        );

                    return false;
                });

                calendar.fullCalendar('unselect');

            }
            ,
            eventClick: function (calEvent, jsEvent, view) {

                var form = $("<form class='form-inline'><label>Change event name &nbsp;</label></form>");
                form.append("<input class='middle' autocomplete=off type=text value='" + calEvent.title + "' /> ");
                form.append("<button type='submit' class='btn btn-sm btn-success'><i class='icon-ok'></i> Save</button>");

                var div = bootbox.dialog({
                    message: form,

                    buttons: {
                        "delete": {
                            "label": "<i class='icon-trash'></i> Delete Event",
                            "className": "btn-sm btn-danger",
                            "callback": function () {
                                calendar.fullCalendar('removeEvents', function (ev) {
                                    return (ev._id == calEvent._id);
                                })
                            }
                        },
                        "close": {
                            "label": "<i class='icon-remove'></i> Close",
                            "className": "btn-sm"
                        }
                    }

                });

                form.on('submit', function () {
                    calEvent.title = form.find("input[type=text]").val();
                    calendar.fullCalendar('updateEvent', calEvent);
                    div.modal("hide");
                    return false;
                });
            }
        });



        $.ajax({
            type: "post",
            url: '../../MessageCalendar/GetCalendar',
            data: {},
            dataType: "json",
            success: function (data) {
                for (var i = 0; i < data.rows.length; i++) {
                    $('#calendar').fullCalendar('renderEvent',
                                         {
                                             title: data.rows[i].title,
                                             start: data.rows[i].start,
                                             Remark: data.rows[i].Remark,
                                             UserNames: data.rows[i].UserNames,
                                             end: data.rows[i].end,
                                             allDay: false
                                         },
                                         true // make the event "stick"
                                     );
                }
            }, error: function (data) {
                alert(data);
            }
        });

        //$('#calendar').fullCalendar('renderEvent',
        //        {
        //            title: "小娃儿",
        //            start: '2017-06-04 18:00:00',
        //            Remark: "Remark",
        //            UserNames: "李银、小俊子",
        //            end: '2017-06-04 22:00:00',
        //            allDay: false
        //        },
        //        true // make the event "stick"
        //    );
    })


    function formatterdate(time, format) {
        var t = new Date(time);
        var tf = function (i) { return (i < 10 ? '0' : '') + i };
        return format.replace(/yyyy|MM|dd|HH|mm|ss/g, function (a) {
            switch (a) {
                case 'yyyy':
                    return tf(t.getFullYear());
                    break;
                case 'MM':
                    return tf(t.getMonth() + 1);
                    break;
                case 'mm':
                    return tf(t.getMinutes());
                    break;
                case 'dd':
                    return tf(t.getDate());
                    break;
                case 'HH':
                    return tf(t.getHours());
                    break;
                case 'ss':
                    return tf(t.getSeconds());
                    break;
            }
        })
    }
</script>